{% extends "base.html" %}
{% block title %}Home - Pex{% endblock %}
{% block content %}
<h1>Posts</h1>

{% if posts %}
  {% for post in posts %}
  <div class="card mb-3">
    <div class="card-body">
      <p class="card-text">{{ post.content }}</p>
      <p class="text-muted small">Por <strong>{{ post.author.username }}</strong> em {{ post.date_posted.strftime('%d/%m/%Y %H:%M') }}</p>

      <div class="d-flex gap-2">
        <a class="btn btn-outline-primary btn-sm" href="{{ url_for('like_post', post_id=post.id) }}">
          <i class="fa-regular fa-heart"></i> Curtir ({{ post.likes|length }})
        </a>
        <a class="btn btn-outline-secondary btn-sm" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u={{ request.url_root }}post/{{ post.id }}">
          <i class="fab fa-facebook"></i> Facebook
        </a>
        <a class="btn btn-outline-secondary btn-sm" target="_blank" href="https://www.instagram.com/?url={{ request.url_root }}post/{{ post.id }}">
          <i class="fab fa-instagram"></i> Instagram
        </a>
        <a class="btn btn-outline-success btn-sm" target="_blank" href="https://api.whatsapp.com/send?text={{ post.content }}%20{{ request.url_root }}post/{{ post.id }}">
          <i class="fab fa-whatsapp"></i> WhatsApp
        </a>
      </div>

      <hr>
      <h6>Coment√°rios</h6>
      {% for c in post.comments %}
        <div class="mb-1"><strong>{{ c.user.username }}:</strong> {{ c.content }}</div>
      {% endfor %}

      {% if current_user.is_authenticated %}
      <form method="POST" action="{{ url_for('comment', post_id=post.id) }}" class="mt-2 d-flex gap-2">
        <input name="content" class="form-control form-control-sm" placeholder="Comente..." required>
        <button class="btn btn-sm btn-primary" type="submit">Enviar</button>
      </form>
      {% endif %}

    </div>
  </div>
  {% endfor %}
{% else %}
  <p>Nenhum post ainda.</p>
{% endif %}

{% endblock %}
